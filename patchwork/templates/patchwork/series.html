{% extends "base.html" %}

{% load person %}

{% block title %}{{project.name}}{% endblock %}
{% block heading %}{{project.name}}{% endblock %}
{% block headers %}
<script language="JavaScript" type="text/javascript">
$(function () {
    pw.setup_series({ patches: 'series-patchlist' });
    pw.amend_context({ series: {{ series.pk }} });
    pw.setup_editable_fields([{
        name: 'reviewer'
{% if series.reviewer %}
        ,value: { pk: {{ series.reviewer.pk }},
                  display_name: "{{ series.reviewer.name }}" }
{% else %}
        ,value: { pk: null, name: null }
{% endif %}
        ,init_from_series: function(o) {
            this.value.pk = o.reviewer;
            this.value.display_name = o.reviewer__name;
        }
        ,is_null: function() { return !this.value.pk; }
        ,text: function() { return this.value.display_name; }
        ,autocomplete: { url: '/complete_user',
                         display_field: 'display_name',
                         search_fields: ['username', 'display_name'] }
    }]);
});
</script>
{% endblock %}
{% block breadcrumb %}
<a href="{% url 'series_list' project=project.linkname %}">{{ project.linkname }} series</a> &#8594; {{ series.name }}
{% endblock %}

{% block body %}
<h2>{{ series.name }}</h2>

<div class="core-info">
  <span>Submitted by {{ series.submitter|personify:project }} on {{ series.submitted }}</span>
</div>

<h2>Details</h2>

<table class="patchmeta">
  <tr>
    <th>Reviewer</th>
    <td>
      <span id="field-reviewer">
        <span id="field-reviewer-text">
{% if series.reviewer %}
          {{ series.reviewer.name }}
{% else %}
        <em class="text-muted">None</em>
{% endif %}
        </span>
{% if is_editable %}
        <span class="glyphicon glyphicon-pencil" ></span>
{% endif %}
      </span>
      <div id="edit-reviewer" class="form-inline" style="display:none;">
        <div class="form-group">
          <input type="text" class="form-control input-sm editable-field">
          <button id="save-reviewer" type="button" class="btn btn-primary btn-sm">Save</button>
          <button id="cancel-reviewer" type="button" class="btn btn-default btn-sm">Cancel</button>
        </div>
      </div>
    </td>
  </tr>
  <tr>
    <th>Submitted</th>
    <td>{{ series.submitted }}</td>
  </tr>
  <tr>
    <th>Last Updated</th>
    <td>{{ series.last_updated }}</td>
  </tr>
  <tr>
    <th>Revision</th>
    <td>{{ series.version }}</td>
  </tr>
</table>

{% if cover_letter %}
<h2>Cover Letter</h2>

<div class="comment">
  <pre class="content">
{{ cover_letter }}
  </pre>
</div>

{% endif %}
<h2>Patches</h2>

<table class="table table-hover table-condensed pw-list" id="series-patchlist">
  <thead>
    <tr>
      <th>#</th>
      <th>Name</th>
      <th>Submitter</th>
      <th>State</th>
    </tr>
  </thead>
  <tbody>
{% for patch in patches %}
    <tr>
      <td>.</td>
      <td><a href="{% url 'patchwork.views.patch.patch' patch_id=patch.id %}"
        >{{ patch.name|default:"[no subject]"|truncatechars:100 }}</a></td>
      <td>{{ patch.submitter|personify:project }}</td>
      <td>{{ patch.state }}</td>
    <tr>
{% endfor %}
  </tbody>
</table>

{% endblock %}
